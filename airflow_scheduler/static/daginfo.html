<div class="contain">
  <table class="table table-hover">
    <thead>
      <tr>
        <th scope="col">Notebook Name</th>
        <th scope="col">Last Run Time</th>
        <th scope="col">Last Run Status</th>
        <th scope="col">Last Run Duration</th>
        <th scope="col">Next Scheduled Run</th>
        <th scope="col">Action</th>
      </tr>
    </thead>
    {% for dag in dag_list %}
    <tr>
      <td><a href='#' onclick="redirect();">{{ dag[0] }}</a></td>
      <td data-value='{{ dag[1] }}'>{{ dag[1] }}</td>
      <td>{{ dag[2] }}</td>
      <td>{{ dag[3] }}</td>
      <td data-value='{{ dag[4] }}'>{{ dag[4] }}</td>
      <td>
        <form id="{{ dag[0] }}del" action="{{ base_url }}scheduler/delete_dag?notebook_name={{ dag[0] }}" method="POST">
          <button type="submit" class="btn btn-primary">Remove</button>
          {% raw xsrf_form_html() %}
        </form>
      </td>
      <td>
        <button id="{{ dag[0] }}edt" type="submit" class="btn btn-primary" data-toggle="collapse"
          data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">Edit</button>
      </td>
    </tr>
    {% end %}
    </tbody>
  </table>
</div>

<div class="collapse" id="collapseExample">
  <div class="card card-body">
    <div id="popup_place_holder"></div>
  </div>
</div>

<script>
  {% for dag in dag_list %}
  $('#{{ dag[0] }}del').submit(function (e) {
    e.preventDefault();
    var result = confirm("Are you sure you want to delete?");
    if (result) { this.submit(); }
    else { return false; }
    setTimeout(function () {
      $('.scheduled_jobs').click().tab('show');
    }, 100);
  });
  {% end %}


  {% for dag in dag_list %}
  $('#{{ dag[0] }}edt').click(function () {
    $('#popup_place_holder').load('{{ base_url }}scheduler/edit_dag?notebook_name={{ dag[0] }}&base_url={{ base_url }}');
  });
  {% end %}

  function redirect() {
    window.open("http://localhost:8080")
  }

  function to_local_datetime(datetime) {
    var mm = datetime.getMonth() + 1; // getMonth() is zero-based
    var dd = datetime.getDate();
    var MM = datetime.getMinutes();
    var HH = datetime.getHours();

    return [
      datetime.getFullYear(),
      (mm > 9 ? '' : '0') + mm,
      (dd > 9 ? '' : '0') + dd
    ].join('-')
      + " "
      + [
        (HH > 9 ? '' : '0') + HH,
        (MM > 9 ? '' : '0') + MM,
      ].join(':')
  }

  function reformat_datetime() {
    $('td[data-value]').each((idx, elem) => {
      (elem.dataset.value != 'N/A')
        ? elem.innerHTML = to_local_datetime(new Date(elem.dataset.value))
        : ''
    })
  }

  $(document).ready(function () {
    reformat_datetime()
  });

</script>